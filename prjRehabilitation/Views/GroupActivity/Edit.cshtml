@using prjRehabilitation.ViewModel.Eric
@model CGroupActivityEditViewModel

@{
    ViewData["Title"] = "Edit";
    DateTime dd = new DateTime(Convert.ToInt32(Model.cgavm.FDate.Split('-')[0]), Convert.ToInt32(Model.cgavm.FDate.Split('-')[1]), Convert.ToInt32(Model.cgavm.FDate.Split('-')[2]));
    //Layout = "AdminLayout";
}

@section Styles{
    <style>

    </style>
}


<h1>活動記錄</h1>

<h4>編輯</h4>
<hr />
<div class="row">
    <div class="col">
        <form asp-action="Edit">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" name="cgavm.FGroupActivityId" value=@Model.cgavm.FGroupActivityId />

            <div class="form-group">
                <label asp-for="cgavm.FEventType" class="control-label"></label>
                <select asp-for="cgavm.FEventType" asp-items="@(new SelectList(Model.GroupActivityType))" class="form-control"></select>
                <span asp-validation-for="cgavm.FEventType" class="text-danger"></span>
            </div>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label asp-for="cgavm.FDate" class="control-label"></label>
                        <input asp-for=@dd type="date" class="form-control" name="cgavm.FDate" />
                        <span asp-validation-for="cgavm.FDate" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="cgavm.FStartTime" class="control-label"></label>
                        <input type="time" asp-for="cgavm.FStartTime" class="form-control" />
                        <span asp-validation-for="cgavm.FStartTime" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="cgavm.FEndTime" class="control-label"></label>
                        <input type="time" asp-for="cgavm.FEndTime" class="form-control" />
                        <span asp-validation-for="cgavm.FEndTime" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="cgavm.FGroupName" class="control-label"></label>
                        <input asp-for="cgavm.FGroupName" class="form-control" />
                        <span asp-validation-for="cgavm.FGroupName" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="cgavm.FClassName" class="control-label"></label>
                        <input asp-for="cgavm.FClassName" class="form-control" />
                        <span asp-validation-for="cgavm.FClassName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-4 mt-3 form-group" id="EventType" style="border-radius: 10px; background-color:gray;"></div>
            </div>
            <div class="form-group">
                <label asp-for="cgavm.FGoal" class="control-label"></label>
                <input asp-for="cgavm.FGoal" class="form-control" />
                <span asp-validation-for="cgavm.FGoal" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="cgavm.FLocation" class="control-label"></label>
                <input asp-for="cgavm.FLocation" class="form-control" />
                <span asp-validation-for="cgavm.FLocation" class="text-danger"></span>
            </div>
            <div class="row">
                <div class="form-group col-4">
                    <label asp-for="cgavm.FPeopleCount" class="control-label"></label>
                    <input asp-for="cgavm.FPeopleCount" class="form-control" />
                    <span asp-validation-for="cgavm.FPeopleCount" class="text-danger"></span>
                </div>
                <div class="form-group  col-4">
                    <label asp-for="cgavm.FLeader" class="control-label"></label>
                    <input asp-for="cgavm.FLeader" class="form-control" />
                    <span asp-validation-for="cgavm.FLeader" class="text-danger"></span>
                </div>
                <div class="form-group  col-4">
                    <label asp-for="cgavm.FRecorder" class="control-label"></label>
                    <input asp-for="cgavm.FRecorder" class="form-control" />
                    <span asp-validation-for="cgavm.FRecorder" class="text-danger"></span>
                </div>
            </div>
            <label asp-for="cgavm.TScheduleDetails" class="control-label"></label>
            <div class=" mt-3 form-group form-control" id="TScheduleDetails" style=" background-color:gray; "></div>

            <div class="form-group">
                <label asp-for="cgavm.FProcess" class="control-label"></label>
                <textarea asp-for="cgavm.FProcess" class="form-control"></textarea>
                <span asp-validation-for="cgavm.FProcess" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="cgavm.FAchievement" class="control-label"></label>
                <textarea asp-for="cgavm.FAchievement" class="form-control"></textarea>
                <span asp-validation-for="cgavm.FAchievement" class="text-danger"></span>
            </div>

            <label asp-for="cgavm.TPersonalPerformances" class="control-label"></label>
            <div class="row">
                <div class="col-md-2">
                    @*<i id="PerformanceAddPersonal" class="fa fa-plus fa-2x" aria-hidden="true"></i>*@

                    <div id="PersonalListPanel" class=" mt-3 form-group form-control" style=" background-color:gray;"></div>
                </div>
                <div class="col-md-10">
                    <div class=" mt-3 form-group form-control" id="TPersonalPerformances" style=" background-color:gray;"></div>
                </div>
            </div>



            <div class="row">
                <div class="form-group col-sm">
                    <label asp-for="cgavm.FFillFormStaff" class="control-label"></label>
                    <input asp-for="cgavm.FFillFormStaff" class="form-control" />
                    <span asp-validation-for="cgavm.FFillFormStaff" class="text-danger"></span>
                </div>
                <div class="form-group col-sm">
                    <label asp-for="cgavm.FFillFormDate" class="control-label"></label>
                    <input asp-for="cgavm.FFillFormDate" class="form-control" />
                    <span asp-validation-for="cgavm.FFillFormDate" class="text-danger"></span>
                </div>
                @*        <div class="form-group col-sm-4">
                <label class="control-label"> 修改日期</label>
                <input class="form-control" type="date" value="@DateTime.Today.ToString("yyyy-MM-dd")" disabled="disabled" />

                </div>*@

            </div>
            <br />
            <div class="form-group">
                <input type="submit" value="送出" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>
<br />
<div>
    <a asp-action="List">回列表</a>
</div>

@section Scripts {

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>

        $("#EventType").load("@Url.Content("~/")GroupActivity/ClassThemesPartialView/@Model.cgavm.FGroupActivityId");
        $("#TScheduleDetails").load("@Url.Content("~/")GroupActivity/ScheduleDetailsPartialView/@Model.cgavm.FGroupActivityId");
        $("#TPersonalPerformances").load("@Url.Content("~/")GroupActivity/PersonalPerformancesPartialView/@Model.cgavm.FGroupActivityId");

        async function getResidentInPersonalPerformancesSelectPanel() {
            const pplist = document.querySelector('#PersonalListPanel');
            const response = await fetch(`@Url.Content("~/")GroupActivityAjax/getResident`);
            const getResidentData = JSON.parse(await response.text());
            for (let aa of getResidentData) {
                pplist.insertAdjacentHTML("beforeend", `<input type="button" id="selectPanel-${aa.fid}" class="addintoR genric-btn info circle arrow  small mt-1 form-control" value="${aa.fName}">`)
            }

            const alladdintoRQuery = document.querySelectorAll('.addintoR');
            for (let i = 0; i < alladdintoRQuery.length; i++) {
                alladdintoRQuery[i].addEventListener("click", async function () {

                    const response = await fetch(`@Url.Content("~/")GroupActivityAjax/CPersonalPerformancesPartialViewViewModelList`);
                    const getResidentData = JSON.parse(JSON.parse(await response.text()));
                    //console.log(this.id);
                    document.querySelector("#TPersonalPerformances").insertAdjacentHTML("beforeend",`
                                <div class="card">
            <div class="card-body">
                <div class="row"><label class="h5 genric-btn info circle">${this.value}</label></div>
                <div class="row">
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">表情情緒：</label><br />
                                        <select id="${this.id}-${this.value}-comboxEmotions" class="mt-2"></select>

                    </div>
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">持續度：</label><br />
                                        <select id="${this.id}-${this.value}-comboxParticipatePersistence"  class="mt-2"></select>

                    </div>
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">配合度：</label><br />
                                        <select id="${this.id}-${this.value}-comboxCooperate"  class="mt-2"></select>

                    </div>
                </div>
                <div class="row">
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">人際互動：</label><br />
                                        <select id="${this.id}-${this.value}-comboxHumanInteraction"  class="mt-2"></select>

                    </div>
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">注意力：</label><br />
                                        <select id="${this.id}-${this.value}-comboxAttentionRes" class="mt-2"></select>

                    </div>
                    <div class="col-4">
                        <label class="badge rounded-pill bg-info text-dark">參與表現：</label><br />
                                        <select id="${this.id}-${this.value}-comboxParticipatePerformance" class="mt-2"></select>

                    </div>
                </div>
                <div class="row"><label class="col-auto badge rounded-pill bg-info text-dark m-2">備註：</label><br /><input type="text"  class="" /></div>
            </div>
        </div>

                    `);
                    const comboxEmotionsID = document.querySelector(`#${this.id}-${this.value}-comboxEmotions`);
                    const comboxParticipatePersistenceID = document.querySelector(`#${this.id}-${this.value}-comboxParticipatePersistence`);
                    const comboxCooperateID = document.querySelector(`#${this.id}-${this.value}-comboxCooperate`);
                    const comboxHumanInteractionID = document.querySelector(`#${this.id}-${this.value}-comboxHumanInteraction`);
                    const comboxAttentionResID = document.querySelector(`#${this.id}-${this.value}-comboxAttentionRes`);
                    const comboxParticipatePerformanceID = document.querySelector(`#${this.id}-${this.value}-comboxParticipatePerformance`);
                    for (var comboxEmotionsItem of getResidentData[0]){
                        comboxEmotionsID.insertAdjacentHTML("beforeend", `<option>${comboxEmotionsItem}</option>`)
                    }
                    for (var comboxParticipatePersistenceItem of getResidentData[1]) {
                        comboxParticipatePersistenceID.insertAdjacentHTML("beforeend", `<option>${comboxParticipatePersistenceItem}</option>`)
                    }
                    for (var comboxCooperateItem of getResidentData[2]){
                        comboxCooperateID.insertAdjacentHTML("beforeend", `<option>${comboxCooperateItem}</option>`)
                    }
                    for (var comboxHumanInteractionItem of getResidentData[3]){
                        comboxHumanInteractionID.insertAdjacentHTML("beforeend", `<option>${comboxHumanInteractionItem}</option>`)
                    }
                    for (var comboxAttentionResItem of getResidentData[4]) {
                        comboxAttentionResID.insertAdjacentHTML("beforeend", `<option>${comboxAttentionResItem}</option>`)
                    }
                    for (var comboxParticipatePerformanceItem of getResidentData[5]) {
                        comboxParticipatePerformanceID.insertAdjacentHTML("beforeend", `<option>${comboxParticipatePerformanceItem}</option>`)
                    }

                });
            }
        }
        getResidentInPersonalPerformancesSelectPanel();//叫出所有人列表





    </script>

}

